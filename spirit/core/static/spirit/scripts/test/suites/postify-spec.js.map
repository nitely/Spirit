{"version":3,"file":"postify-spec.js","sources":["postify-spec.coffee"],"names":[],"mappings":"AAAA;EAAA,QAAA,CAAS,sBAAT,EAAiC,SAAA;AAC7B,QAAA;IAAA,MAAA,GAAS;IACT,cAAA,GAAiB;IAEjB,QAAA,GAAW,SAAS,CAAC,KAAK,CAAC;IAE3B,UAAA,CAAW,SAAA;MACP,QAAQ,CAAC,IAAI,CAAC,SAAd,GAA0B;MAK1B,MAAA,GAAS,QAAQ,CAAC,gBAAT,CAA0B,UAA1B;aACT,cAAA,GAAiB,SAAS,CAAC,OAAV,CAAkB,MAAlB,EAA0B;QACvC,SAAA,EAAW,QAD4B;OAA1B;IAPV,CAAX;IAWA,SAAA,CAAU,SAAA;aACN,KAAK,CAAC,IAAN,CAAW,QAAQ,CAAC,gBAAT,CAA0B,kBAA1B,CAAX,CAAyD,CAAC,OAA1D,CAAkE,SAAC,GAAD;eAC9D,GAAG,CAAC,UAAU,CAAC,WAAf,CAA2B,GAA3B;MAD8D,CAAlE;IADM,CAAV;IAKA,EAAA,CAAG,+CAAH,EAAoD,SAAA;AAChD,UAAA;MAAA,GAAA,GAAM,QAAQ,CAAC,WAAT,CAAqB,YAArB;MACN,GAAG,CAAC,SAAJ,CAAc,OAAd,EAAuB,KAAvB,EAA8B,IAA9B;MACA,eAAA,GAAkB,KAAA,CAAM,GAAN,EAAW,iBAAX;MAClB,cAAA,GAAiB,KAAA,CAAM,GAAN,EAAW,gBAAX;MAEjB,MAAA,GAAS,KAAA,CAAM,MAAM,CAAC,eAAe,CAAC,SAA7B,EAAwC,QAAxC;MACT,MAAM,CAAC,GAAG,CAAC,QAAX,CAAqB,SAAA,GAAA,CAArB;MAEA,MAAO,CAAA,CAAA,CAAE,CAAC,aAAV,CAAwB,GAAxB;MACA,MAAA,CAAO,MAAM,CAAC,KAAK,CAAC,KAAb,CAAA,CAAP,CAA4B,CAAC,OAA7B,CAAqC,CAArC;MACA,MAAA,CAAO,eAAP,CAAuB,CAAC,gBAAxB,CAAA;aACA,MAAA,CAAO,cAAP,CAAsB,CAAC,gBAAvB,CAAA;IAZgD,CAApD;WAcA,EAAA,CAAG,kBAAH,EAAuB,SAAA;AACnB,UAAA;MAAA,MAAA,GAAS,KAAA,CAAM,MAAM,CAAC,eAAe,CAAC,SAA7B,EAAwC,QAAxC;MACT,MAAM,CAAC,GAAG,CAAC,QAAX,CAAqB,SAAA,GAAA,CAArB;MAEA,MAAO,CAAA,CAAA,CAAE,CAAC,KAAV,CAAA;MACA,IAAA,GAAO,QAAQ,CAAC,aAAT,CAAuB,kBAAvB;MAEP,MAAA,CAAO,MAAM,CAAC,KAAK,CAAC,KAAb,CAAA,CAAP,CAA4B,CAAC,OAA7B,CAAqC,CAArC;MACA,MAAA,CAAO,IAAI,CAAC,YAAL,CAAkB,QAAlB,CAAP,CAAmC,CAAC,OAApC,CAA4C,SAA5C;MACA,MAAA,CAAO,QAAA,CAAS,CAAC,IAAD,CAAT,CAAP,CAAwB,CAAC,OAAzB,CAAiC,IAAjC;aACA,MAAA,CAAO,QAAQ,CAAC,aAAT,CAAuB,iCAAvB,CAAyD,CAAC,KAAjE,CAAuE,CAAC,OAAxE,CAAgF,QAAhF;IAVmB,CAAvB;EApC6B,CAAjC;AAAA","sourcesContent":["describe \"postify plugin tests\", ->\n    a_post = null\n    plugin_postify = null\n\n    isHidden = stModules.utils.isHidden\n\n    beforeEach ->\n        document.body.innerHTML = \"\"\"\n        <a class=\"js-post\" href=\"/link1/\">link</a>\n        <a class=\"js-post\" href=\"/link2/\">link 2</a>\n        \"\"\"\n\n        a_post = document.querySelectorAll('.js-post')\n        plugin_postify = stModules.postify(a_post, {\n            csrfToken: \"foobar\"\n        })\n\n    afterEach ->\n        Array.from(document.querySelectorAll('.js-postify-form')).forEach((elm) ->\n            elm.parentNode.removeChild(elm)\n        )\n\n    it \"prevents the default click behaviour on click\", ->\n        evt = document.createEvent(\"HTMLEvents\")\n        evt.initEvent(\"click\", false, true)\n        stopPropagation = spyOn(evt, 'stopPropagation')\n        preventDefault = spyOn(evt, 'preventDefault')\n\n        submit = spyOn(window.HTMLFormElement.prototype, 'submit')\n        submit.and.callFake( -> )\n\n        a_post[0].dispatchEvent(evt)\n        expect(submit.calls.count()).toEqual(1)\n        expect(stopPropagation).toHaveBeenCalled()\n        expect(preventDefault).toHaveBeenCalled()\n\n    it \"submits the form\", ->\n        submit = spyOn(window.HTMLFormElement.prototype, 'submit')\n        submit.and.callFake( -> )\n\n        a_post[0].click()\n        form = document.querySelector('.js-postify-form')\n\n        expect(submit.calls.count()).toEqual(1)\n        expect(form.getAttribute('action')).toEqual(\"/link1/\")\n        expect(isHidden([form])).toEqual(true)\n        expect(document.querySelector('input[name=csrfmiddlewaretoken]').value).toEqual(\"foobar\")\n"]}