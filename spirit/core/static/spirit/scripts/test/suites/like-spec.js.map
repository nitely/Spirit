{"version":3,"sources":["like-spec.coffee"],"names":[],"mappings":"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","file":"like-spec.js","sourceRoot":"/source/","sourcesContent":["describe \"like plugin tests\", ->\n    likes = null\n    like = null\n    Like = null\n    post = null\n    data = null\n\n    beforeEach ->\n        fixtures = do jasmine.getFixtures\n        fixtures.fixturesPath = 'base/test/fixtures/'\n        loadFixtures 'like.html'\n\n        post = spyOn $, 'post'\n        post.and.callFake (req) ->\n            d = $.Deferred()\n            d.resolve(data)  # success\n            #d.reject()  # failure\n            return d.promise()\n\n        data =\n            url_delete: \"/foo/delete/\"\n\n        likes = $('.js-like').like {\n            csrfToken: \"foobar\",\n            likeText: \"foo like ({count})\",\n            removeLikeText: \"foo remove like ({count})\"\n        }\n        like = likes.first().data 'plugin_like'\n        Like = $.fn.like.Like\n\n    it \"doesnt break selector chaining\", ->\n        expect(likes).toEqual $('.js-like')\n        expect(likes.length).toEqual 2\n\n    it \"can create the like\", ->\n        expect($.post.calls.any()).toEqual false\n\n        likes.first().trigger 'click'\n        expect($.post.calls.any()).toEqual true\n        expect($.post.calls.argsFor(0)).toEqual ['/foo/create/', {csrfmiddlewaretoken: \"foobar\", }]\n\n    it \"can create and remove the like\", ->\n        # create\n        data =\n            url_delete: \"/foo/delete/\"\n        likes.first().trigger 'click'\n        expect($.post.calls.argsFor(0)).toEqual ['/foo/create/', {csrfmiddlewaretoken: \"foobar\", }]\n        expect(likes.first().text()).toEqual \"foo remove like (1)\"\n\n        # remove\n        data =\n            url_create: \"/foo/create/\"\n        likes.first().trigger 'click'\n        expect($.post.calls.argsFor(1)).toEqual ['/foo/delete/', {csrfmiddlewaretoken: \"foobar\", }]\n        expect(likes.first().text()).toEqual \"foo like (0)\"\n\n        # create again... and so on...\n        data =\n            url_delete: \"/foo/delete/\"\n        likes.first().trigger 'click'\n        expect($.post.calls.argsFor(2)).toEqual ['/foo/create/', {csrfmiddlewaretoken: \"foobar\", }]\n        expect(likes.first().text()).toEqual \"foo remove like (1)\"\n\n    it \"will tell about an api change\", ->\n        data =\n            unknown: null\n\n        likes.first().trigger 'click'\n        expect(likes.first().text()).toEqual \"api error\"\n\n    it \"prevents from multiple posts while sending\", ->\n        expect($.post.calls.any()).toEqual false\n\n        d = $.Deferred()\n        post.and.callFake (req) =>\n            d.resolve(data)\n            return d.promise()\n\n        always = spyOn post(), 'always'\n        post.calls.reset()\n        likes.first().trigger 'click'\n        expect($.post.calls.any()).toEqual true\n        expect(always.calls.any()).toEqual true\n\n        # next click should do nothing\n        post.calls.reset()\n        likes.first().trigger 'click'\n        expect($.post.calls.any()).toEqual false\n\n    it \"prevents the default click behaviour\", ->\n        event = {type: 'click', stopPropagation: (->), preventDefault: (->)}\n        stopPropagation = spyOn event, 'stopPropagation'\n        preventDefault = spyOn event, 'preventDefault'\n\n        likes.first().trigger event\n        expect(stopPropagation).toHaveBeenCalled()\n        expect(preventDefault).toHaveBeenCalled()\n"]}