{"version":3,"file":"like-spec.js","sources":["like-spec.coffee"],"names":[],"mappings":"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","sourcesContent":["describe \"like plugin tests\", ->\n    likeElms = null\n    likes = null\n    post = null\n    responseData = null\n\n    beforeEach ->\n        document.body.innerHTML = \"\"\"\n        <div>\n          <ul>\n            <li><a class=\"js-like\" href=\"/foo/create/\" data-count=\"0\"><i class=\"fa fa-heart\"></i> like</a></li>\n          </ul>\n        </div>\n        <div>\n          <ul>\n            <li><a class=\"js-like\" href=\"foo/delete/\" data-count=\"1\"><i class=\"fa fa-heart\"></i> remove like</a></li>\n          </ul>\n        </div>\n        \"\"\"\n\n        responseData = {url_create: '/create/foo'}\n\n        post = spyOn(global, 'fetch')\n        post.and.callFake( -> {\n            then: (func) ->\n                data = func({ok: true, json: -> responseData})\n                return {\n                    then: (func) ->\n                        func(data)\n                        return {catch: -> {then: (func) -> func()}}\n                }\n        })\n\n        likeElms = document.querySelectorAll('.js-like')\n        likes = stModules.like(likeElms, {\n            csrfToken: \"foobar\",\n            likeText: \"foo like ({count})\",\n            removeLikeText: \"foo remove like ({count})\"\n        })\n\n    it \"can create the like\", ->\n        post.calls.reset()\n        likeElms[0].click()\n        expect(post.calls.any()).toEqual(true)\n        expect(post.calls.argsFor(0)[0]).toEqual('/foo/create/')\n        expect(post.calls.argsFor(0)[1].body.get('csrfmiddlewaretoken')).toEqual(\"foobar\")\n\n    it \"can create and remove the like\", ->\n        # create\n        post.calls.reset()\n        responseData = {url_delete: \"/foo/delete/\"}\n        likeElms[0].click()\n        expect(post.calls.argsFor(0)[0]).toEqual('/foo/create/')\n        expect(likeElms[0].textContent).toEqual(\"foo remove like (1)\")\n\n        # remove\n        post.calls.reset()\n        responseData = {url_create: \"/foo/create/\"}\n        likeElms[0].click()\n        expect(post.calls.argsFor(0)[0]).toEqual('/foo/delete/')\n        expect(likeElms[0].textContent).toEqual(\"foo like (0)\")\n\n        # create again... and so on...\n        post.calls.reset()\n        responseData = {url_delete: \"/foo/delete/\"}\n        likeElms[0].click()\n        expect(post.calls.argsFor(0)[0]).toEqual('/foo/create/')\n        expect(likeElms[0].textContent).toEqual(\"foo remove like (1)\")\n\n    it \"will tell about an api change\", ->\n        responseData = {unknown: null}\n        likeElms[0].click()\n        expect(likeElms[0].textContent).toEqual(\"api error\")\n\n    it \"prevents from multiple posts while sending\", ->\n        post.and.callFake( -> {then: -> {then: -> {catch: -> {then: -> }}}})\n        likeElms[0].click()\n\n        # next click should do nothing\n        post.calls.reset()\n        likeElms[0].click()\n        expect(post.calls.any()).toEqual(false)\n\n    it \"prevents the default click behaviour\", ->\n        evt = document.createEvent(\"HTMLEvents\")\n        evt.initEvent(\"click\", false, true)\n\n        stopPropagation = spyOn(evt, 'stopPropagation')\n        preventDefault = spyOn(evt, 'preventDefault')\n\n        likeElms[0].dispatchEvent(evt)\n        expect(stopPropagation).toHaveBeenCalled()\n        expect(preventDefault).toHaveBeenCalled()\n"]}