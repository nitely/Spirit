{"version":3,"file":"store-spec.js","sources":["store-spec.coffee"],"names":[],"mappings":"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","sourcesContent":["describe \"store plugin tests\", ->\n    textarea = null\n    storage = null\n\n    beforeEach ->\n        document.body.innerHTML = \"\"\"\n        <form action=\".\">\n          <textarea id=\"my-fixture\"></textarea>\n          <textarea id=\"my-fixture-2\"></textarea>\n        </form>\n        \"\"\"\n\n        localStorage.clear()\n        textarea = document.querySelector('#my-fixture')\n        storage = stModules.store(textarea, 'unique-id')\n\n    it \"loads previous stored value\", ->\n        localStorage.setItem('unique-id', \"text\")\n        textarea = document.querySelector('#my-fixture-2')\n        stModules.store(textarea, 'unique-id')\n        expect(textarea.value).toEqual(\"text\")\n\n    it \"updates the field on storage change\", ->\n        # Some browsers won't trigger \"storage\" on assignments\n        localStorage.setItem('unique-id', \"text\")\n\n        evt = document.createEvent(\"HTMLEvents\")\n        evt.initEvent(\"storage\", false, true)\n        window.dispatchEvent(evt)\n\n        expect(textarea.value).toEqual(\"text\")\n\n    it \"saves value to localStorage on input\", ->\n        textarea.value = \"foobar\"\n        expect(localStorage.getItem('unique-id')).toEqual(null)\n\n        evt = document.createEvent(\"HTMLEvents\")\n        evt.initEvent(\"input\", false, true)\n        textarea.dispatchEvent(evt)\n\n        expect(localStorage.getItem('unique-id')).toEqual(\"foobar\")\n\n    it \"wont (re)update the field on input\", ->\n        # \"storage\" gets triggered (maybe) while updating the Storage,\n        # however this should not (re)update the text-area\n\n        localStorage.setItem('unique-id', \"no-foobar\")\n        textarea.value = \"foobar\"\n\n        setItem = spyOn(window.Storage.prototype, 'setItem')\n        setItem.and.callFake( ->\n            # Force storage event\n            evt = document.createEvent(\"HTMLEvents\")\n            evt.initEvent(\"storage\", false, true)\n            window.dispatchEvent(evt)\n        )\n\n        evt = document.createEvent(\"HTMLEvents\")\n        evt.initEvent(\"input\", false, true)\n        textarea.dispatchEvent(evt)\n\n        expect(setItem.calls.count()).toEqual(1)\n        expect(localStorage.getItem('unique-id')).toEqual(\"no-foobar\")\n        expect(textarea.value).toEqual(\"foobar\")\n\n    it \"gets cleared on submit\", ->\n        localStorage.setItem('unique-id', \"text\")\n\n        form = document.querySelector('form')\n        form.addEventListener('submit', (e) -> e.preventDefault())\n        evt = document.createEvent(\"HTMLEvents\")\n        evt.initEvent(\"submit\", false, true)\n        form.dispatchEvent(evt)\n\n        expect(localStorage.getItem('unique-id')).toEqual(null)\n"]}