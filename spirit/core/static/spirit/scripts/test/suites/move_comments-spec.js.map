{"version":3,"file":"move_comments-spec.js","sources":["move_comments-spec.coffee"],"names":[],"mappings":"AAAA;EAAA,QAAA,CAAS,4BAAT,EAAuC,SAAA;AACnC,QAAA;IAAA,kBAAA,GAAqB;IACrB,oBAAA,GAAuB;IAEvB,QAAA,GAAW,SAAS,CAAC,KAAK,CAAC;IAE3B,UAAA,CAAW,SAAA;MACP,QAAQ,CAAC,IAAI,CAAC,SAAd,GAA0B;MAiB1B,kBAAA,GAAqB,QAAQ,CAAC,gBAAT,CAA0B,wBAA1B;aACrB,oBAAA,GAAuB,SAAS,CAAC,YAAV,CAAuB,kBAAvB,EAA2C;QAC9D,SAAA,EAAW,QADmD;QAE9D,MAAA,EAAQ,OAFsD;OAA3C;IAnBhB,CAAX;IAwBA,SAAA,CAAU,SAAA;aAGN,KAAK,CAAC,IAAN,CAAW,QAAQ,CAAC,gBAAT,CAA0B,uBAA1B,CAAX,CAA8D,CAAC,OAA/D,CAAuE,SAAC,GAAD;eACnE,GAAG,CAAC,UAAU,CAAC,WAAf,CAA2B,GAA3B;MADmE,CAAvE;IAHM,CAAV;IAOA,EAAA,CAAG,8BAAH,EAAmC,SAAA;MAC/B,MAAA,CAAO,QAAA,CAAS,QAAQ,CAAC,gBAAT,CAA0B,wBAA1B,CAAT,CAAP,CAAqE,CAAC,OAAtE,CAA8E,IAA9E;MACA,MAAA,CAAO,QAAQ,CAAC,gBAAT,CAA0B,2BAA1B,CAAsD,CAAC,MAA9D,CAAqE,CAAC,OAAtE,CAA8E,CAA9E;MAEA,kBAAmB,CAAA,CAAA,CAAE,CAAC,KAAtB,CAAA;MACA,MAAA,CAAO,QAAA,CAAS,QAAQ,CAAC,gBAAT,CAA0B,wBAA1B,CAAT,CAAP,CAAqE,CAAC,OAAtE,CAA8E,KAA9E;aACA,MAAA,CAAO,QAAQ,CAAC,gBAAT,CAA0B,2BAA1B,CAAsD,CAAC,MAA9D,CAAqE,CAAC,OAAtE,CAA8E,CAA9E;IAN+B,CAAnC;IAQA,EAAA,CAAG,4DAAH,EAAiE,SAAA;AAC7D,UAAA;MAAA,GAAA,GAAM,QAAQ,CAAC,WAAT,CAAqB,YAArB;MACN,GAAG,CAAC,SAAJ,CAAc,OAAd,EAAuB,KAAvB,EAA8B,IAA9B;MACA,eAAA,GAAkB,KAAA,CAAM,GAAN,EAAW,iBAAX;MAClB,cAAA,GAAiB,KAAA,CAAM,GAAN,EAAW,gBAAX;MAEjB,kBAAmB,CAAA,CAAA,CAAE,CAAC,aAAtB,CAAoC,GAApC;MACA,MAAA,CAAO,eAAP,CAAuB,CAAC,gBAAxB,CAAA;aACA,MAAA,CAAO,cAAP,CAAsB,CAAC,gBAAvB,CAAA;IAR6D,CAAjE;IAUA,EAAA,CAAG,gDAAH,EAAqD,SAAA;AACjD,UAAA;MAAA,GAAA,GAAM,QAAQ,CAAC,WAAT,CAAqB,YAArB;MACN,GAAG,CAAC,SAAJ,CAAc,OAAd,EAAuB,KAAvB,EAA8B,IAA9B;MACA,eAAA,GAAkB,KAAA,CAAM,GAAN,EAAW,iBAAX;MAClB,cAAA,GAAiB,KAAA,CAAM,GAAN,EAAW,gBAAX;MAEjB,MAAA,GAAS,KAAA,CAAM,MAAM,CAAC,eAAe,CAAC,SAA7B,EAAwC,QAAxC;MACT,MAAM,CAAC,GAAG,CAAC,QAAX,CAAqB,SAAA,GAAA,CAArB;MAEA,QAAQ,CAAC,aAAT,CAAuB,0BAAvB,CAAkD,CAAC,aAAnD,CAAiE,GAAjE;MACA,MAAA,CAAO,MAAM,CAAC,KAAK,CAAC,KAAb,CAAA,CAAP,CAA4B,CAAC,OAA7B,CAAqC,CAArC;MACA,MAAA,CAAO,eAAP,CAAuB,CAAC,gBAAxB,CAAA;aACA,MAAA,CAAO,cAAP,CAAsB,CAAC,gBAAvB,CAAA;IAZiD,CAArD;WAcA,EAAA,CAAG,kBAAH,EAAuB,SAAA;AACnB,UAAA;MAAA,MAAA,GAAS,KAAA,CAAM,MAAM,CAAC,eAAe,CAAC,SAA7B,EAAwC,QAAxC;MACT,MAAM,CAAC,GAAG,CAAC,QAAX,CAAqB,SAAA,GAAA,CAArB;MAEA,QAAQ,CAAC,aAAT,CAAuB,wBAAvB,CAAgD,CAAC,KAAjD,CAAA;MACA,QAAQ,CAAC,aAAT,CAAuB,0BAAvB,CAAkD,CAAC,KAAnD,CAAA;MACA,IAAA,GAAO,QAAQ,CAAC,aAAT,CAAuB,uBAAvB;MAEP,MAAA,CAAO,MAAM,CAAC,KAAK,CAAC,KAAb,CAAA,CAAP,CAA4B,CAAC,OAA7B,CAAqC,CAArC;MACA,MAAA,CAAO,IAAI,CAAC,YAAL,CAAkB,QAAlB,CAAP,CAAmC,CAAC,OAApC,CAA4C,OAA5C;MACA,MAAA,CAAO,QAAA,CAAS,CAAC,IAAD,CAAT,CAAP,CAAwB,CAAC,OAAzB,CAAiC,IAAjC;MACA,MAAA,CAAO,IAAI,CAAC,aAAL,CAAmB,iCAAnB,CAAqD,CAAC,KAA7D,CAAmE,CAAC,OAApE,CAA4E,QAA5E;MACA,MAAA,CAAO,IAAI,CAAC,aAAL,CAAmB,mBAAnB,CAAuC,CAAC,KAA/C,CAAqD,CAAC,OAAtD,CAA8D,IAA9D;aACA,MAAA,CAAO,IAAI,CAAC,gBAAL,CAAsB,sBAAtB,CAA6C,CAAC,MAArD,CAA4D,CAAC,OAA7D,CAAqE,CAArE;IAbmB,CAAvB;EArEmC,CAAvC;AAAA","sourcesContent":["describe \"move_comments plugin tests\", ->\n    show_move_comments = null\n    plugin_move_comments = null\n\n    isHidden = stModules.utils.isHidden\n\n    beforeEach ->\n        document.body.innerHTML = \"\"\"\n        <a class=\"js-show-move-comments\" href=\"#\" >Select comments to move</a>\n        <div class=\"js-move-comments-form\" style=\"display:none;\">\n          <div class=\"move-container\">\n            <label>Topic id:</label>\n            <input id=\"id_move_comments_topic\" type=\"text\" value=\"10\" />\n            <a class=\"js-move-comments-button\" href=\"#move_url\">Move</a>\n          </div>\n        </div>\n        <div class=\"js-comment\" data-pk=\"1\">\n          <ul class=\"js-move-comment-checkbox-list\"></ul>\n        </div>\n        <div class=\"js-comment\" data-pk=\"2\">\n          <ul class=\"js-move-comment-checkbox-list\"></ul>\n        </div>\n        \"\"\"\n\n        show_move_comments = document.querySelectorAll('.js-show-move-comments')\n        plugin_move_comments = stModules.moveComments(show_move_comments, {\n            csrfToken: \"foobar\",\n            target: \"/foo/\"\n        })\n\n    afterEach ->\n        # Fixture will only remove itself not nodes appended to body\n        # so we have to manually remove forms\n        Array.from(document.querySelectorAll('.js-move-comment-form')).forEach((elm) ->\n            elm.parentNode.removeChild(elm)\n        )\n\n    it \"shows the move form on click\", ->\n        expect(isHidden(document.querySelectorAll(\".js-move-comments-form\"))).toEqual(true)\n        expect(document.querySelectorAll(\".js-move-comment-checkbox\").length).toEqual(0)\n\n        show_move_comments[0].click()\n        expect(isHidden(document.querySelectorAll(\".js-move-comments-form\"))).toEqual(false)\n        expect(document.querySelectorAll(\".js-move-comment-checkbox\").length).toEqual(2)\n\n    it \"prevents the default click behaviour on show move comments\", ->\n        evt = document.createEvent(\"HTMLEvents\")\n        evt.initEvent(\"click\", false, true)\n        stopPropagation = spyOn(evt, 'stopPropagation')\n        preventDefault = spyOn(evt, 'preventDefault')\n\n        show_move_comments[0].dispatchEvent(evt)\n        expect(stopPropagation).toHaveBeenCalled()\n        expect(preventDefault).toHaveBeenCalled()\n\n    it \"prevents the default click behaviour on submit\", ->\n        evt = document.createEvent(\"HTMLEvents\")\n        evt.initEvent(\"click\", false, true)\n        stopPropagation = spyOn(evt, 'stopPropagation')\n        preventDefault = spyOn(evt, 'preventDefault')\n\n        submit = spyOn(window.HTMLFormElement.prototype, 'submit')\n        submit.and.callFake( -> )\n\n        document.querySelector(\".js-move-comments-button\").dispatchEvent(evt)\n        expect(submit.calls.count()).toEqual(1)\n        expect(stopPropagation).toHaveBeenCalled()\n        expect(preventDefault).toHaveBeenCalled()\n\n    it \"submits the form\", ->\n        submit = spyOn(window.HTMLFormElement.prototype, 'submit')\n        submit.and.callFake( -> )\n\n        document.querySelector(\".js-show-move-comments\").click()\n        document.querySelector(\".js-move-comments-button\").click()\n        form = document.querySelector(\".js-move-comment-form\")\n\n        expect(submit.calls.count()).toEqual(1)\n        expect(form.getAttribute('action')).toEqual(\"/foo/\")\n        expect(isHidden([form])).toEqual(true)\n        expect(form.querySelector(\"input[name=csrfmiddlewaretoken]\").value).toEqual(\"foobar\")\n        expect(form.querySelector(\"input[name=topic]\").value).toEqual(\"10\")\n        expect(form.querySelectorAll(\"input[name=comments]\").length).toEqual(2)\n"]}