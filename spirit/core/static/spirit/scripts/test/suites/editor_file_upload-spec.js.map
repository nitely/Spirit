{"version":3,"file":"editor_file_upload-spec.js","sources":["editor_file_upload-spec.coffee"],"names":[],"mappings":"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","sourcesContent":["describe \"editor file upload plugin tests\", ->\n    textarea = null\n    editorFileUpload = null\n    data = null\n    inputFile = null\n    file = null\n    post = null\n\n    beforeEach ->\n        fixtures = do jasmine.getFixtures\n        fixtures.fixturesPath = 'base/test/fixtures/'\n        loadFixtures 'editor.html'\n\n        post = spyOn $, 'ajax'\n        post.and.callFake (req) ->\n            d = $.Deferred()\n            d.resolve(data)  # success\n            #d.reject()  # failure\n            return d.promise()\n\n        data =\n            url: \"/path/file.pdf\"\n        file =\n            name: \"foo.pdf\"\n\n        textarea = $('#id_comment').editor_file_upload {\n            csrfToken: \"foo csrf_token\",\n            target: \"/foo/\",\n            placeholderText: \"foo uploading {name}\",\n            allowedFileMedia: \".doc,.docx,.pdf\"\n        }\n        editorFileUpload = textarea.first().data 'plugin_editor_file_upload'\n        inputFile = editorFileUpload.inputFile\n\n    it \"doesnt break selector chaining\", ->\n        expect(textarea).toEqual $('#id_comment')\n        expect(textarea.length).toEqual 1\n\n    it \"does nothing if the browser is not supported\", ->\n        org_formData = window.FormData\n        window.FormData = null\n        try\n            # remove event from beforeEach editor to prevent popup\n            $(\".js-box-file\").off 'click'\n\n            textarea2 = $('#id_comment2').editor_file_upload()\n            inputFile2 = textarea2.data('plugin_editor_file_upload').inputFile\n\n            trigger = spyOn inputFile2, 'trigger'\n            $(\".js-box-file\").trigger 'click'\n            expect(trigger).not.toHaveBeenCalled()\n        finally\n            window.FormData = org_formData\n\n    it \"opens the file choose dialog\", ->\n        trigger = spyOn inputFile, 'trigger'\n        $(\".js-box-file\").trigger 'click'\n        expect(trigger).toHaveBeenCalled()\n\n    it \"uploads the file\", ->\n        expect($.ajax.calls.any()).toEqual false\n\n        formDataMock = jasmine.createSpyObj('formDataMock', ['append', ])\n        spyOn(window, \"FormData\").and.returnValue formDataMock\n        spyOn(inputFile, 'get').and.returnValue {files: [file, ]}\n        inputFile.trigger 'change'\n        expect($.ajax.calls.any()).toEqual true\n        expect($.ajax.calls.argsFor(0)).toEqual [ { url: '/foo/', data: formDataMock, processData: false, contentType: false, type: 'POST' } ]\n        expect(formDataMock.append).toHaveBeenCalledWith('csrfmiddlewaretoken', 'foo csrf_token')\n        expect(formDataMock.append).toHaveBeenCalledWith('file', { name : 'foo.pdf' })\n\n    it \"changes the placeholder on upload success\", ->\n        textarea.val \"foobar\"\n\n        spyOn(inputFile, 'get').and.returnValue {files: [file, ]}\n        inputFile.trigger 'change'\n        expect(textarea.val()).toEqual \"foobar[foo.pdf](/path/file.pdf)\"\n\n    it \"changes the placeholder on upload error\", ->\n        textarea.val \"foobar\"\n\n        data =\n            error: {foo: \"foo error\", }\n\n        spyOn(inputFile, 'get').and.returnValue {files: [file, ]}\n        inputFile.trigger 'change'\n        expect(textarea.val()).toEqual \"foobar[{\\\"error\\\":{\\\"foo\\\":\\\"foo error\\\"}}]()\"\n\n    it \"changes the placeholder on upload failure\", ->\n        textarea.val \"foobar\"\n\n        d = $.Deferred()\n        post.and.callFake (req) ->\n            d.reject(null, \"foo statusError\", \"bar error\")  # failure\n            return d.promise()\n\n        spyOn(inputFile, 'get').and.returnValue {files: [file, ]}\n        inputFile.trigger 'change'\n        expect(textarea.val()).toEqual \"foobar[error: foo statusError bar error]()\"\n\n    it \"checks for default media file extensions if none are provided\", ->\n        expect(inputFile[0].outerHTML).toContain(\".doc,.docx,.pdf\")\n\n    it \"checks for custom media file extensions if they are provided\", ->\n        textarea3 = $('#id_comment3').editor_file_upload {\n            csrfToken: \"foo csrf_token\",\n            target: \"/foo/\",\n            placeholderText: \"foo uploading {file_name}\"\n            allowedFileMedia: [\".superdoc\"]\n        }\n        editorFileUpload3 = textarea3.first().data 'plugin_editor_file_upload'\n        inputFile3 = editorFileUpload3.inputFile\n        expect(inputFile3[0].outerHTML).not.toContain(\".doc,.docx,.pdf\")\n        expect(inputFile3[0].outerHTML).toContain(\".superdoc\")\n"]}